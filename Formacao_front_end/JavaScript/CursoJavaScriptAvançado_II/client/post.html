<!-- aluraframe/client/post.html -->
<html>

<head>
    <meta charset="UTF-8">
    <title>Negociações</title>
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/bootstrap-theme.css">
</head>

<body class="container">
    <form class="form">

        <div class="form-group">
            <label for="data">Data</label>
            <input type="date" id="data" class="form-control" required autofocus/>
        </div>

        <div class="form-group">
            <label for="quantidade">Quantidade</label>
            <input type="number" min="1" step="1" id="quantidade" class="form-control" value="1" required/>
        </div>

        <div class="form-group">
            <label for="valor">Valor</label>
            <input id="valor" type="number" class="form-control" min="0.01" step="0.01" value="0.0" required />
        </div>

        <button class="btn btn-primary" type="submit" onclick="sendPost(event)">Enviar dados para servidor</button>
    </form>

    <script>
        let $ = document.querySelector.bind(document);

        function sendPost(event) {
            //https://stackoverflow.com/questions/9713058/send-post-data-using-xmlhttprequest
            event.preventDefault();
            //aqui você deve ler os dados do formulário
            //construir o json
            let negociacao = {
                data: $('#data').value,
                quantidade: $('#quantidade').value,
                valor: $('#valor').value
            };
            //enviar o XMLHttpRequest

            //criando objeto para comunicação com o servidor
            let xhr = new XMLHttpRequest();
            //DOMString method,DOMString url,optional boolean async, optional DOMString user,optional DOMString password
            xhr.open('POST', '/negociacoes', true);

            //setando o cabeçalho
            xhr.setRequestHeader('Content-type', 'application/json');

            xhr.onreadystatechange = () => {
                if (xhr.readyState == 4) {
                    if (xhr.status == 200) {
                        $('#data').value = '';
                        $('#quantidade').value = 1;
                        $('#valor').value = 0.0;
                        $('#data').focus();
                        console.log('Negociação cadastrada com sucesso');
                    } else {
                        console.log('Erro ao cadastrar negociação');
                    }
                    console.log(xhr.responseText);
                }
            };
            //chamando o cadastramento
            xhr.send(JSON.stringify(negociacao));
        }
    </script>
</body>

</html>